<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>QR Card - Employee</title>

<style>
:root{
  --green-dark:#1f3d2b;
  --green:#3a6f45;
  --green-light:#9bc27e;
  --paper:#ffffff;
  --ink:#0f172a;
}

*{ box-sizing:border-box; font-family:system-ui,-apple-system,"Segoe UI",Roboto,Arial,sans-serif; }

body{
  margin:0;
  background:#eef2f0;
  padding:20px;
}

.topbar{
  display:flex;
  gap:10px;
  justify-content:center;
  align-items:center;
  flex-wrap:wrap;
  margin-bottom:12px;
}

select, button, a.btn{
  padding:10px 14px;
  border-radius:10px;
  border:none;
  font-weight:700;
}

select{ min-width:260px; }

button,.btn{
  background:#0b84c6;
  color:#fff;
  cursor:pointer;
  text-decoration:none;
}

.card{
  width:420px;
  margin:auto;
  background:var(--paper);
  border-radius:16px;
  overflow:hidden;
  box-shadow:0 18px 40px rgba(0,0,0,.15);
}

.card-inner{
  display:grid;
  grid-template-columns:140px 1fr;
  min-height:240px;
}

/* LEFT GREEN SIDE */
.left{
  background:linear-gradient(160deg,var(--green-dark),var(--green));
  padding:16px;
  display:flex;
  flex-direction:column;
  justify-content:space-between;
}

.qr{
  background:#fff;
  padding:6px;
  border-radius:10px;
}
.qr img{ width:100%; display:block; }

.logo{
  width:56px;
  height:56px;
  background:#fff;
  padding:6px;
  border-radius:50%;
  object-fit:contain;
}

/* RIGHT SIDE */
.right{
  padding:16px;
  display:flex;
  flex-direction:column;
  gap:6px;
}

.empName{
  font-size:18px;
  font-weight:900;
  color:var(--green);
}

.role{
  font-size:12px;
  font-weight:700;
  margin-bottom:6px;
}

.item{
  display:flex;
  align-items:center;
  gap:8px;
  font-size:12px;
  font-weight:600;
}

.icon{
  width:18px;
  height:18px;
  background:var(--green);
  color:#fff;
  border-radius:50%;
  display:grid;
  place-items:center;
  font-size:11px;
  line-height:1;
}

.location{
  margin-top:auto;
  background:var(--green-light);
  padding:6px 8px;
  border-radius:6px;
  font-size:11px;
  font-weight:700;
}

a{ color:inherit; text-decoration:none; }

/* PRINT */
@page{ size:3.5in 2in; margin:0; }
@media print{
  body{ padding:0; background:#fff; }
  .topbar{ display:none; }
  .card{
    width:3.5in;
    height:2in;
    box-shadow:none;
    border-radius:0;
  }
}
</style>
</head>

<body>

<div class="topbar">
  <select id="empSelect"></select>
  <button onclick="window.print()">Print</button>
  <a id="openProfileBtn" class="btn" target="_blank">Open Profile</a>
</div>

<div class="card">
  <div class="card-inner">

    <!-- LEFT -->
    <div class="left">
      <img id="logoImg" class="logo" alt="Logo">
      <div class="qr"><img id="qrImg" alt="QR"></div>
    </div>

    <!-- RIGHT -->
    <div class="right">
      <!-- ‚úÖ FIX: id changed from "name" to "empName" -->
      <div class="empName" id="empName">‚Äî</div>
      <div class="role" id="designation">‚Äî</div>

      <div class="item">
        <div class="icon">üìû</div>
        <div id="phone">‚Äî</div>
      </div>

      <div class="item">
        <div class="icon">üåê</div>
        <div id="website">‚Äî</div>
      </div>

      <div class="item">
        <div class="icon">‚úâ</div>
        <div id="email">‚Äî</div>
      </div>

      <div class="location" id="address">‚Äî</div>
    </div>

  </div>
</div>

<script>
  const qrUrl = (t) =>
    "https://api.qrserver.com/v1/create-qr-code/?size=420x420&data=" + encodeURIComponent(t);

  // Works on localhost + GitHub Pages
  const profileUrl = (id) => {
    const u = new URL("index.html", window.location.href);
    u.searchParams.set("id", id);
    return u.toString();
  };

  fetch("employees.json", { cache: "no-store" })
    .then((r) => r.json())
    .then((list) => {
      const sel = document.getElementById("empSelect");
      sel.innerHTML = list.map((e) => `<option value="${e.id}">${e.name}</option>`).join("");

      const pick = new URLSearchParams(location.search).get("id");
      if (pick && list.some((x) => x.id === pick)) sel.value = pick;

      const set = (e) => {
        document.getElementById("empName").textContent = e.name || "‚Äî";

        // ‚úÖ supports designation OR role
        document.getElementById("designation").textContent = (e.designation || e.role) || "‚Äî";

        document.getElementById("phone").innerHTML =
          e.phone ? `<a href="tel:${e.phone}">${e.phone}</a>` : "‚Äî";

        document.getElementById("website").innerHTML =
          e.website ? `<a href="${e.website}" target="_blank">${e.website.replace(/^https?:\/\//,'')}</a>` : "‚Äî";

        document.getElementById("email").innerHTML =
          e.email ? `<a href="mailto:${e.email}">${e.email}</a>` : "‚Äî";

        document.getElementById("address").textContent = e.address || "‚Äî";

        document.getElementById("qrImg").src = qrUrl(profileUrl(e.id));
        document.getElementById("logoImg").src = e.logo || "logo.png";
        document.getElementById("openProfileBtn").href = profileUrl(e.id);
      };

      const getCurrent = () => list.find((x) => x.id === sel.value) || list[0];

      set(getCurrent());
      sel.addEventListener("change", () => set(getCurrent()));
    })
    .catch((err) => {
      document.body.innerHTML = `<div style="max-width:820px;margin:60px auto;font-family:system-ui;color:#111">
        <h2 style="margin:0 0 8px">Error loading employees</h2>
        <div style="color:#6b7280">${err.message}</div>
        <div style="margin-top:10px;color:#6b7280">Make sure <b>employees.json</b> is in the same folder as this page.</div>
      </div>`;
    });
</script>

</body>
</html>
